import{a as Ye,b as He,c as Ze,d as je,e as We,f as Xe,g as Ge,h as qe}from"/build/_shared/chunk-NBT5ECOQ.js";import{a as he}from"/build/_shared/chunk-WGU6A3MF.js";import{A as ct,B as it,E as at,F as ut,G as lt,H as mt,I as dt,J as pt,K as ee,L as ft,a as Ie,b as _e,c as Be,d as Je,e as fe,g as Ue,i as $,n as Ke,q as Qe,t as $e,u as et,v as tt,w as nt,x as rt,y as ot,z as st}from"/build/_shared/chunk-CXYRRBW7.js";import{a as Re}from"/build/_shared/chunk-LE7JPKRK.js";import{a as Ve}from"/build/_shared/chunk-RF4KE5FM.js";import{a as De}from"/build/_shared/chunk-DCJLI3GM.js";import{b as Fe}from"/build/_shared/chunk-TLUPFBOO.js";import{a as ze,c as Oe}from"/build/_shared/chunk-HPPG3BMY.js";import{a as Te,b as de,d as Pe,g as pe,j as T,k as Ne}from"/build/_shared/chunk-CG2D626R.js";import{a as yt,b as Ae}from"/build/_shared/chunk-GDLBX7ER.js";import{c as me}from"/build/_shared/chunk-Q3IECNXJ.js";var e=me(yt(),1);var L={earth:"ZmELm",loader:"_3Zj-K",viewport:"VsYMm",canvas:"pkDcI",labels:"d0q8g",label:"KG5kS",vignette:"_7Vp-6",sections:"_3lOoe",section:"_0MQQ9"};var v=me(Ae(),1),ye={x:0,y:0,z:2},ge=(c,f,h)=>c+h*(f-c),ht=c=>Object.keys(c).map(f=>parseFloat(Math.round(c[f]*100)/100).toFixed(2)).join(", "),be=c=>!c||!c.camera?ye:{x:c.camera[0],y:c.camera[1],z:c.camera[2]},St=(c,f)=>{let h=(N=0)=>Math.round((N+Number.EPSILON)*100)/100;return h(c?.x)===h(f?.x)&&h(c?.y)===h(f?.y)&&h(c?.z)===h(f?.z)},ve={stiffness:80,damping:40,mass:2,restSpeed:.001,restDelta:.001},we={stiffness:40,damping:30,mass:2,restSpeed:.001,restDelta:.001},xt={stiffness:40,damping:30},gt=(0,e.createContext)({}),_t=({position:c=[0,0,0],scale:f=1,hideMeshes:h=[],labels:N=[],className:G,children:q})=>{let[d,I]=(0,e.useState)(!1),[F,R]=(0,e.useState)(!1),[_,te]=(0,e.useState)(!1),[B,bt]=(0,e.useState)(!1),g=(0,e.useRef)([]),ne=(0,e.useRef)(),re=(0,e.useRef)(),V=(0,e.useRef)(),P=(0,e.useRef)(),S=(0,e.useRef)(),i=(0,e.useRef)(),Se=(0,e.useRef)(),xe=(0,e.useRef)(),oe=(0,e.useRef)(),p=(0,e.useRef)(),J=(0,e.useRef)(),Y=(0,e.useRef)(),O=De(V),U=(0,e.useRef)(),se=(0,e.useRef)(be(g.current[0])),K=(0,e.useRef)([]),x=(0,e.useRef)(),ce=(0,e.useRef)(),Ce=(0,e.useRef)(),ie=(0,e.useRef)(),{width:H,height:ae}=Re(),Q=Ne(),k=T(0,ve),M=T(0,ve),A=T(0,ve),Z=T(0,we),j=T(0,we),W=T(0,we),D=T(0,xt),ue=(0,e.useCallback)(()=>{if(!O){cancelAnimationFrame(U.current);return}U.current=requestAnimationFrame(ue);let n=Se.current.getDelta();Y.current.update(n),x.current.update(),S.current.render(P.current,i.current),K.current.forEach(o=>{let{element:a,position:b,sprite:w}=o,l=new $(...b),s=i.current.position.distanceTo(p.current.position),m=i.current.position.distanceTo(w.position)>s;l.project(i.current),l.x=Math.round((.5+l.x/2)*window.innerWidth),l.y=Math.round((.5-l.y/2)*window.innerHeight),a.style.setProperty("--posX",de(l.x)),a.style.setProperty("--posY",de(l.y)),m?a.dataset.occluded=!0:a.dataset.occluded=!1})},[O]);(0,e.useEffect)(()=>{ie.current=!0;let{innerWidth:n,innerHeight:o}=window;S.current=new $e({canvas:V.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),S.current.setPixelRatio(1),S.current.outputColorSpace=fe,S.current.toneMapping=Ie,i.current=new Ke(54,n/o,.1,100),i.current.position.x=se.current.x,i.current.position.y=se.current.y,i.current.position.z=se.current.z,i.current.lookAt(0,0,0),k.set(i.current.position.x,!1),M.set(i.current.position.y,!1),A.set(i.current.position.z,!1),P.current=new et,Se.current=new ot,oe.current=new ct;let a=new rt(2236962,.05),b=new nt(16777215,1.5);b.position.set(3,0,1);let w=[a,b];return w.forEach(l=>P.current.add(l)),x.current=new it(i.current,V.current),x.current.enableZoom=!1,x.current.enablePan=!1,x.current.enableDamping=!1,x.current.rotateSpeed=.5,()=>{ie.current=!1,cancelAnimationFrame(U.current),pt(w),mt(P.current),dt(S.current)}},[]),(0,e.useEffect)(()=>{let n=()=>{R(!0),k.stop(),M.stop(),A.stop()},o=()=>{k.set(i.current.position.x,!1),M.set(i.current.position.y,!1),A.set(i.current.position.z,!1),R(!1)};return x.current.addEventListener("start",n),x.current.addEventListener("end",o),()=>{x.current.removeEventListener("start",n),x.current.removeEventListener("end",o)}},[k,M,A]),(0,e.useEffect)(()=>{if(!d)return;let n=ee("Chunk",p.current),o=ee("Atmosphere",p.current),a=(t,u)=>{i.current.position[t]=u},b=k.on("change",t=>a("x",t)),w=M.on("change",t=>a("y",t)),l=A.on("change",t=>a("z",t)),s=(t,u)=>{n.position[t]=u},z=Z.on("change",t=>s("x",t)),m=j.on("change",t=>s("y",t)),C=W.on("change",t=>s("z",t)),r=D.on("change",t=>{o.material.opacity=t});return()=>{b(),w(),l(),z(),m(),C(),r()}},[k,M,A,Z,j,W,d,D]),(0,e.useEffect)(()=>{H<=Te.tablet&&(x.current.enabled=!1)},[H]),(0,e.useEffect)(()=>{if(d)return;let n=new at,o=new Qe(S.current);o.compileCubemapShader();let a=async()=>{let s=await ut.loadAsync(Ye);p.current=s.scene,J.current=s.animations,Y.current=new st(p.current),Y.current.timeScale=.1,p.current.traverse(async z=>{let{material:m,name:C}=z;C==="Atmosphere"&&(m.alphaMap=m.map),m&&await S.current.initTexture(m)}),p.current.position.x=c[0],p.current.position.y=c[1],p.current.position.z=c[2],p.current.scale.x=f,p.current.scale.y=f,p.current.scale.z=f},b=async()=>{let s=await n.loadAsync([He,Ze,je,We,Xe,Ge]);s.magFilter=Be,ce.current=o.fromCubemap(s),o.dispose(),await S.current.initTexture(ce.current.texture)},w=async()=>{let s=await lt.loadAsync(qe);s.mapping=_e,s.colorSpace=fe,P.current.background=s,await S.current.initTexture(s)},l=async()=>{await Promise.all([w(),b(),a()]),p.current.traverse(({material:s})=>{s&&(s.envMap=ce.current.texture,s.needsUpdate=!0)}),ie.current&&I(!0)};(0,e.startTransition)(()=>{l(),setTimeout(()=>{bt(!0)},1e3)})},[d,c,f]),(0,e.useEffect)(()=>(d&&!Ce.current&&(P.current.add(p.current),Ce.current=!0),d&&O&&(te(!0),ue()),()=>{cancelAnimationFrame(U.current)}),[ue,O,d]),(0,e.useEffect)(()=>{d&&(re.current.innerHTML="",K.current=N.map(n=>{let o=document.createElement("div");o.classList.add(L.label),o.dataset.hidden=!0,o.style.setProperty("--delay",`${n.delay||0}ms`),o.textContent=n.text,re.current.appendChild(o);let a=new tt;return a.position.set(...n.position),a.scale.set(60,60,1),{element:o,...n,sprite:a}}))},[N,d]),(0,e.useEffect)(()=>{S.current.setSize(H,ae),i.current.aspect=H/ae,i.current.updateProjectionMatrix()},[H,ae]),(0,e.useEffect)(()=>{let n=V.current,o=a=>{let{innerWidth:b,innerHeight:w}=window,l=ht(i.current.position);console.info({cameraPosition:l}),xe.current=new Ue(a.clientX/b*2-1,-(a.clientY/w)*2+1),oe.current.setFromCamera(xe.current,i.current);let s=oe.current.intersectObjects(P.current.children,!0);if(s.length>0){let z=ht(s[0].point);console.info({clickPosition:z})}};return()=>{n.removeEventListener("click",o)}},[]);let Ee=(0,e.useCallback)(()=>{if(!ne.current)return;let{offsetTop:n}=ne.current,{innerHeight:o}=window,a=window.scrollY-n,b,w=m=>{let C=g.current[m].meshes;p.current.traverse(r=>{let{name:t}=r,u=ee("Chunk",p.current),y=C?.includes(t),X=h?.includes(t);if(y)if(t==="Atmosphere")r.visible=!0,D.set(1);else if(t==="Chunk"){let E=new $(-.4,.4,.4);r.visible=!0,Q?r.position.set(...E.toArray()):(Z.set(E.x),j.set(E.y),W.set(E.z))}else t==="EarthFull"&&u.visible?r.visible=!1:r.visible=!0;else if(X&&!y)if(t==="Atmosphere")D.set(0);else if(t==="Chunk"){let E=new $(0,0,0);St(E,u.position)&&(r.visible=!1),Z.set(E.x),j.set(E.y),W.set(E.z)}else t==="EarthPartial"&&u.visible?r.visible=!0:r.visible=!1})},l=m=>{let C=g.current[m].animations;Q||(J.current.forEach((r,t)=>{C.find(u=>u.includes(t.toString()))||Y.current.clipAction(r).reset().stop()}),J.current.length&&g.current[m].animations&&C.forEach(r=>{let t=r.split(":"),u=J.current[Number(t[0])],y=Y.current.clipAction(u);(!t[1]||t[1]!=="loop")&&(y.clampWhenFinished=!0,y.loop=Je),y.play()}))},s=m=>{K.current.forEach(r=>{r.hidden&&(r.element.dataset.hidden=!0,r.element.setAttribute("aria-hidden",!0))}),g.current[m].labels.forEach(r=>{K.current.filter(u=>u.text===r).forEach(u=>{u.element.dataset.hidden=!1,u.element.setAttribute("aria-hidden",!1)})})};requestAnimationFrame(()=>{let m=g.current.length-1,C=Math.floor(a/o),r=he(C,0,m),t=g.current[r],u=g.current[r+1],y=be(t)||ye,X=be(u)||ye,E=(a-o*r)/o,le=he(E,0,1),Le=ge(y.x,X.x,le),ke=ge(y.y,X.y,le),Me=ge(y.z,X.z,le);if(b!==y&&g.current.length&&t&&(w(r),l(r),s(r)),b=y,!F){if(Q){i.current.position.set(Le,ke,Me);return}k.set(Le),M.set(ke),A.set(Me)}})},[k,M,A,Z,j,W,F,h,D,Q]);(0,e.useEffect)(()=>{let n=ft(Ee,100);return d&&O&&window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)}},[Ee,O,d,D]);let vt=(0,e.useCallback)(n=>{g.current=[...g.current,n]},[]),wt=(0,e.useCallback)(n=>{g.current=g.current.filter(o=>o!==n)},[]);return(0,v.jsx)(gt.Provider,{value:{registerSection:vt,unregisterSection:wt},children:(0,v.jsxs)("div",{className:pe(L.earth,G),ref:ne,children:[(0,v.jsxs)("div",{className:L.viewport,children:[(0,v.jsx)("canvas",{className:L.canvas,"data-visible":d&&_,"data-grabbing":F,ref:V}),(0,v.jsx)("div",{className:L.labels,"aria-live":"polite",ref:re}),(0,v.jsx)("div",{className:L.vignette})]}),(0,v.jsx)("div",{className:L.sections,children:q}),(0,v.jsx)(Oe,{unmount:!0,in:!d&&B,timeout:Pe(ze.base.durationL),children:n=>(0,v.jsx)(Ve,{className:L.loader,"data-visible":n,children:(0,v.jsx)(Fe,{})})})]})})},Bt=(0,e.memo)(({children:c,scrim:f,scrimReverse:h,className:N,camera:G=[0,0,0],animations:q=[],meshes:d=[],labels:I=[]})=>{let{registerSection:F,unregisterSection:R}=(0,e.useContext)(gt),_=(0,e.useRef)(),te=JSON.stringify(q)+JSON.stringify(G)+JSON.stringify(I)+JSON.stringify(d);return(0,e.useEffect)(()=>{let B={camera:G,animations:q,meshes:d,labels:I,sectionRef:_};return F(B),()=>{R(B)}},[te,F,R]),(0,v.jsx)("div",{className:pe(L.section,N),"data-scrim":f,"data-scrim-reverse":h,ref:_,children:c})});export{_t as Earth,Bt as EarthSection};
