import{a as ae}from"/build/_shared/chunk-4W5RFXWF.js";import{C as xe,D as be,F as Le,G as ne,H as Te,I as Re,J as Ae,L as ze,e as J,f as me,h as $,i as C,j as K,k as Q,l as H,m as ee,n as ge,o as he,p as we,r as ye,s as re,t as ve,u as Me,w as te,x as Se}from"/build/_shared/chunk-CXYRRBW7.js";import{a as fe}from"/build/_shared/chunk-UFO47Q2A.js";import{a as pe}from"/build/_shared/chunk-DCJLI3GM.js";import{e as ue,f as le,g as de,j as _,k as j,l as E}from"/build/_shared/chunk-CG2D626R.js";import{a as Ee,b as ie}from"/build/_shared/chunk-GDLBX7ER.js";import{c as Z}from"/build/_shared/chunk-Q3IECNXJ.js";var e=Z(Ee(),1);var oe={model:"qMqUg",canvas:"iryn2"};var P=Z(ie(),1),Ce={Frame:"Frame",Logo:"Logo",Screen:"Screen"},Pe={stiffness:40,damping:20,mass:1.4,restSpeed:.001},He=({models:k,show:S=!0,showDelay:D=0,cameraPosition:h={x:0,y:0,z:8},style:B,className:G,onLoad:U,alt:X,...F})=>{let[x,N]=(0,e.useState)(!1),m=(0,e.useRef)(),l=(0,e.useRef)(),i=(0,e.useRef)(),w=(0,e.useRef)(),t=(0,e.useRef)(),r=(0,e.useRef)(),d=(0,e.useRef)(),p=(0,e.useRef)(),g=(0,e.useRef)(),y=(0,e.useRef)(),c=(0,e.useRef)(),u=(0,e.useRef)(),n=(0,e.useRef)(),f=(0,e.useRef)(),v=(0,e.useRef)(),a=(0,e.useRef)(),I=(0,e.useRef)(),ce=pe(m,!1,{threshold:.2}),se=j(),b=_(0,Pe),L=_(0,Pe);(0,e.useEffect)(()=>{let{clientWidth:o,clientHeight:s}=m.current;r.current=new ve({canvas:l.current,alpha:!0,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),r.current.setPixelRatio(2),r.current.setSize(o,s),r.current.outputColorSpace=J,i.current=new ge(36,o/s,.1,100),i.current.position.set(h.x,h.y,h.z),t.current=new Me,w.current=new re,t.current.add(w.current);let M=new Se(16777215,1.2),R=new te(16777215,1.1),A=new te(16777215,.8);A.position.set(-6,2,2),R.position.set(.5,0,.866),v.current=[M,R,A],v.current.forEach(z=>t.current.add(z)),d.current=new re,t.current.add(d.current),d.current.position.set(0,0,-.8),d.current.rotateX(Math.PI/2);let W=512,V=8,Y=8,ke=1.5,De=.8,Be=3;p.current=new $(W,W),p.current.texture.generateMipmaps=!1,g.current=new $(W,W),g.current.texture.generateMipmaps=!1;let q=new he(V,Y).rotateX(Math.PI/2),Ge=new Q({map:p.current.texture,opacity:De,transparent:!0});f.current=new H(q,Ge),f.current.scale.y=-1,d.current.add(f.current),a.current=new H(q),a.current.visible=!1,d.current.add(a.current);let Fe=new Q({color:16777215,opacity:0,transparent:!0});I.current=new H(q,Fe),I.current.rotateX(Math.PI),I.current.position.y-=1e-5,d.current.add(I.current),y.current=new we(-V/2,V/2,Y/2,-Y/2,0,ke),y.current.rotation.x=Math.PI/2,d.current.add(y.current),c.current=new ye,c.current.userData.darkness={value:Be},c.current.onBeforeCompile=z=>{z.uniforms.darkness=c.current.userData.darkness,z.fragmentShader=`
        uniform float darkness;
        ${z.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}
      `},c.current.depthTest=!1,c.current.depthWrite=!1,u.current=new ee(xe),u.current.depthTest=!1,n.current=new ee(be),n.current.depthTest=!1;let Ie=b.on("change",T),We=L.on("change",T);return()=>{p.current.dispose(),g.current.dispose(),Ae(v.current),Te(t.current),Re(r.current),Ie(),We()}},[]);let O=(0,e.useCallback)(o=>{a.current.visible=!0,a.current.material=u.current,a.current.material.uniforms.tDiffuse.value=p.current.texture,u.current.uniforms.h.value=o*(1/256),r.current.setRenderTarget(g.current),r.current.render(a.current,y.current),a.current.material=n.current,a.current.material.uniforms.tDiffuse.value=g.current.texture,n.current.uniforms.v.value=o*(1/256),r.current.setRenderTarget(p.current),r.current.render(a.current,y.current),a.current.visible=!1},[]),T=(0,e.useCallback)(()=>{let s=t.current.background;t.current.background=null,t.current.overrideMaterial=c.current,r.current.setRenderTarget(p.current),r.current.render(t.current,y.current),t.current.overrideMaterial=null,O(5),O(5*.4),r.current.setRenderTarget(null),t.current.background=s,w.current.rotation.x=b.get(),w.current.rotation.y=L.get(),r.current.render(t.current,i.current)},[O,b,L]);return(0,e.useEffect)(()=>{let o=ze(s=>{let{innerWidth:M,innerHeight:R}=window,A={x:(s.clientX-M/2)/M,y:(s.clientY-R/2)/R};L.set(A.x/2),b.set(A.y/2)},100);return ce&&!se&&window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[ce,se,b,L]),(0,e.useEffect)(()=>{let o=()=>{if(!m.current)return;let{clientWidth:s,clientHeight:M}=m.current;r.current.setSize(s,M),i.current.aspect=s/M,i.current.updateProjectionMatrix(),T()};return window.addEventListener("resize",o),o(),()=>{window.removeEventListener("resize",o)}},[T]),(0,P.jsxs)("div",{className:de(oe.model,G),"data-loaded":x,style:le({delay:ue(D)},B),ref:m,role:"img","aria-label":X,...F,children:[(0,P.jsx)("canvas",{className:oe.canvas,ref:l}),k.map((o,s)=>(0,P.jsx)(Ue,{renderer:r,modelGroup:w,show:S,showDelay:D,renderFrame:T,index:s,setLoaded:N,onLoad:U,model:o},JSON.stringify(o.position)))]})},Ue=({renderer:k,model:S,modelGroup:D,renderFrame:h,index:B,showDelay:G,setLoaded:U,onLoad:X,show:F})=>{let[x,N]=(0,e.useState)(),m=j(),l=(0,e.createRef)();(0,e.useEffect)(()=>{let i=async(t,r)=>{t.colorSpace=J,t.flipY=!1,t.anisotropy=k.current.capabilities.getMaxAnisotropy(),t.generateMipmaps=!1,await k.current.initTexture(t),r.material.color=new K(16777215),r.material.transparent=!0,r.material.map=t};N({start:async()=>{let{texture:t,position:r,url:d}=S,p,g,[y,c]=await Promise.all([await ne.loadAsync(t.placeholder),await Le.loadAsync(d)]);D.current.add(c.scene),c.scene.traverse(async n=>{n.material&&(n.material.color=new K(2039845)),n.name===Ce.Screen&&(l.current=n.clone(),l.current.material=n.material.clone(),n.parent.add(l.current),l.current.material.opacity=1,l.current.position.z+=.001,i(y,l.current),p=async()=>{let f=await fe(t),v=await ne.loadAsync(f);await i(v,n),E(1,0,{onUpdate:a=>{l.current.material.opacity=a,h()}})})});let u=new C(r.x,r.y,r.z);return m&&c.scene.position.set(...u.toArray()),S.animation===ae.SpringUp&&(g=()=>{let n=new C(u.x,u.y-1,u.z);c.scene.position.set(...n.toArray()),E(n.y,u.y,{type:"spring",delay:(300*B+G)/1e3,stiffness:60,damping:20,mass:1,restSpeed:1e-4,restDelta:1e-4,onUpdate:f=>{c.scene.position.y=f,h()}})}),S.animation===ae.LaptopOpen&&(g=()=>{let n=c.scene.children.find(a=>a.name===Ce.Frame),f=new C(me.degToRad(90),0,0),v=new C(0,0,0);return c.scene.position.set(...u.toArray()),n.rotation.set(...f.toArray()),E(f.x,v.x,{type:"spring",delay:(300*B+G+300)/1e3,stiffness:80,damping:20,restSpeed:1e-4,restDelta:1e-4,onUpdate:a=>{n.rotation.x=a,h()}})}),{loadFullResTexture:p,playAnimation:g}}})},[]),(0,e.useEffect)(()=>{if(!x||!F)return;let i,w=async()=>{let{loadFullResTexture:t,playAnimation:r}=await x.start();U(!0),X?.(),m||(i=r()),await t(),m&&h()};return(0,e.startTransition)(()=>{w()}),()=>{i?.stop()}},[x,F])};export{He as Model};
