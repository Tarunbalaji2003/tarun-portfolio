import{a as Ve,b as Ye,c as Ie,d as je,e as We,f as Xe,g as Ze,h as Be}from"/build/_shared/chunk-NBT5ECOQ.js";import{a as he}from"/build/_shared/chunk-WGU6A3MF.js";import{A as ct,B as it,E as at,F as ut,G as lt,H as mt,I as dt,J as pt,K as ee,L as ft,a as Ge,b as qe,c as Je,d as Ue,e as fe,g as _e,i as Q,n as Ke,q as $e,t as Qe,u as et,v as tt,w as nt,x as rt,y as ot,z as st}from"/build/_shared/chunk-CXYRRBW7.js";import{a as De}from"/build/_shared/chunk-LE7JPKRK.js";import{a as He}from"/build/_shared/chunk-RF4KE5FM.js";import{a as Re}from"/build/_shared/chunk-DCJLI3GM.js";import{b as Fe}from"/build/_shared/chunk-TLUPFBOO.js";import{a as Ne,c as Oe}from"/build/_shared/chunk-HPPG3BMY.js";import{a as Te,b as de,d as Pe,g as pe,j as T,k as ze}from"/build/_shared/chunk-CG2D626R.js";import{a as yt,b as Me}from"/build/_shared/chunk-GDLBX7ER.js";import{c as me}from"/build/_shared/chunk-Q3IECNXJ.js";var e=me(yt(),1);var L={earth:"tHKI3",loader:"_9IPHB",viewport:"HhiFT",canvas:"j0AIe",labels:"Ibwng",label:"-c3t4",vignette:"NINY5",sections:"_4CK5n",section:"N-V60"};var v=me(Me(),1),ye={x:0,y:0,z:2},ge=(c,f,h)=>c+h*(f-c),ht=c=>Object.keys(c).map(f=>parseFloat(Math.round(c[f]*100)/100).toFixed(2)).join(", "),be=c=>!c||!c.camera?ye:{x:c.camera[0],y:c.camera[1],z:c.camera[2]},St=(c,f)=>{let h=(z=0)=>Math.round((z+Number.EPSILON)*100)/100;return h(c?.x)===h(f?.x)&&h(c?.y)===h(f?.y)&&h(c?.z)===h(f?.z)},ve={stiffness:80,damping:40,mass:2,restSpeed:.001,restDelta:.001},we={stiffness:40,damping:30,mass:2,restSpeed:.001,restDelta:.001},xt={stiffness:40,damping:30},gt=(0,e.createContext)({}),qt=({position:c=[0,0,0],scale:f=1,hideMeshes:h=[],labels:z=[],className:Z,children:B})=>{let[d,G]=(0,e.useState)(!1),[F,D]=(0,e.useState)(!1),[q,te]=(0,e.useState)(!1),[J,bt]=(0,e.useState)(!1),g=(0,e.useRef)([]),ne=(0,e.useRef)(),re=(0,e.useRef)(),H=(0,e.useRef)(),P=(0,e.useRef)(),S=(0,e.useRef)(),i=(0,e.useRef)(),Se=(0,e.useRef)(),xe=(0,e.useRef)(),oe=(0,e.useRef)(),p=(0,e.useRef)(),U=(0,e.useRef)(),V=(0,e.useRef)(),O=Re(H),_=(0,e.useRef)(),se=(0,e.useRef)(be(g.current[0])),K=(0,e.useRef)([]),x=(0,e.useRef)(),ce=(0,e.useRef)(),Ce=(0,e.useRef)(),ie=(0,e.useRef)(),{width:Y,height:ae}=De(),$=ze(),k=T(0,ve),A=T(0,ve),M=T(0,ve),I=T(0,we),j=T(0,we),W=T(0,we),R=T(0,xt),ue=(0,e.useCallback)(()=>{if(!O){cancelAnimationFrame(_.current);return}_.current=requestAnimationFrame(ue);let n=Se.current.getDelta();V.current.update(n),x.current.update(),S.current.render(P.current,i.current),K.current.forEach(o=>{let{element:a,position:b,sprite:w}=o,l=new Q(...b),s=i.current.position.distanceTo(p.current.position),m=i.current.position.distanceTo(w.position)>s;l.project(i.current),l.x=Math.round((.5+l.x/2)*window.innerWidth),l.y=Math.round((.5-l.y/2)*window.innerHeight),a.style.setProperty("--posX",de(l.x)),a.style.setProperty("--posY",de(l.y)),m?a.dataset.occluded=!0:a.dataset.occluded=!1})},[O]);(0,e.useEffect)(()=>{ie.current=!0;let{innerWidth:n,innerHeight:o}=window;S.current=new Qe({canvas:H.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),S.current.setPixelRatio(1),S.current.outputColorSpace=fe,S.current.toneMapping=Ge,i.current=new Ke(54,n/o,.1,100),i.current.position.x=se.current.x,i.current.position.y=se.current.y,i.current.position.z=se.current.z,i.current.lookAt(0,0,0),k.set(i.current.position.x,!1),A.set(i.current.position.y,!1),M.set(i.current.position.z,!1),P.current=new et,Se.current=new ot,oe.current=new ct;let a=new rt(2236962,.05),b=new nt(16777215,1.5);b.position.set(3,0,1);let w=[a,b];return w.forEach(l=>P.current.add(l)),x.current=new it(i.current,H.current),x.current.enableZoom=!1,x.current.enablePan=!1,x.current.enableDamping=!1,x.current.rotateSpeed=.5,()=>{ie.current=!1,cancelAnimationFrame(_.current),pt(w),mt(P.current),dt(S.current)}},[]),(0,e.useEffect)(()=>{let n=()=>{D(!0),k.stop(),A.stop(),M.stop()},o=()=>{k.set(i.current.position.x,!1),A.set(i.current.position.y,!1),M.set(i.current.position.z,!1),D(!1)};return x.current.addEventListener("start",n),x.current.addEventListener("end",o),()=>{x.current.removeEventListener("start",n),x.current.removeEventListener("end",o)}},[k,A,M]),(0,e.useEffect)(()=>{if(!d)return;let n=ee("Chunk",p.current),o=ee("Atmosphere",p.current),a=(t,u)=>{i.current.position[t]=u},b=k.on("change",t=>a("x",t)),w=A.on("change",t=>a("y",t)),l=M.on("change",t=>a("z",t)),s=(t,u)=>{n.position[t]=u},N=I.on("change",t=>s("x",t)),m=j.on("change",t=>s("y",t)),C=W.on("change",t=>s("z",t)),r=R.on("change",t=>{o.material.opacity=t});return()=>{b(),w(),l(),N(),m(),C(),r()}},[k,A,M,I,j,W,d,R]),(0,e.useEffect)(()=>{Y<=Te.tablet&&(x.current.enabled=!1)},[Y]),(0,e.useEffect)(()=>{if(d)return;let n=new at,o=new $e(S.current);o.compileCubemapShader();let a=async()=>{let s=await ut.loadAsync(Ve);p.current=s.scene,U.current=s.animations,V.current=new st(p.current),V.current.timeScale=.1,p.current.traverse(async N=>{let{material:m,name:C}=N;C==="Atmosphere"&&(m.alphaMap=m.map),m&&await S.current.initTexture(m)}),p.current.position.x=c[0],p.current.position.y=c[1],p.current.position.z=c[2],p.current.scale.x=f,p.current.scale.y=f,p.current.scale.z=f},b=async()=>{let s=await n.loadAsync([Ye,Ie,je,We,Xe,Ze]);s.magFilter=Je,ce.current=o.fromCubemap(s),o.dispose(),await S.current.initTexture(ce.current.texture)},w=async()=>{let s=await lt.loadAsync(Be);s.mapping=qe,s.colorSpace=fe,P.current.background=s,await S.current.initTexture(s)},l=async()=>{await Promise.all([w(),b(),a()]),p.current.traverse(({material:s})=>{s&&(s.envMap=ce.current.texture,s.needsUpdate=!0)}),ie.current&&G(!0)};(0,e.startTransition)(()=>{l(),setTimeout(()=>{bt(!0)},1e3)})},[d,c,f]),(0,e.useEffect)(()=>(d&&!Ce.current&&(P.current.add(p.current),Ce.current=!0),d&&O&&(te(!0),ue()),()=>{cancelAnimationFrame(_.current)}),[ue,O,d]),(0,e.useEffect)(()=>{d&&(re.current.innerHTML="",K.current=z.map(n=>{let o=document.createElement("div");o.classList.add(L.label),o.dataset.hidden=!0,o.style.setProperty("--delay",`${n.delay||0}ms`),o.textContent=n.text,re.current.appendChild(o);let a=new tt;return a.position.set(...n.position),a.scale.set(60,60,1),{element:o,...n,sprite:a}}))},[z,d]),(0,e.useEffect)(()=>{S.current.setSize(Y,ae),i.current.aspect=Y/ae,i.current.updateProjectionMatrix()},[Y,ae]),(0,e.useEffect)(()=>{let n=H.current,o=a=>{let{innerWidth:b,innerHeight:w}=window,l=ht(i.current.position);console.info({cameraPosition:l}),xe.current=new _e(a.clientX/b*2-1,-(a.clientY/w)*2+1),oe.current.setFromCamera(xe.current,i.current);let s=oe.current.intersectObjects(P.current.children,!0);if(s.length>0){let N=ht(s[0].point);console.info({clickPosition:N})}};return()=>{n.removeEventListener("click",o)}},[]);let Ee=(0,e.useCallback)(()=>{if(!ne.current)return;let{offsetTop:n}=ne.current,{innerHeight:o}=window,a=window.scrollY-n,b,w=m=>{let C=g.current[m].meshes;p.current.traverse(r=>{let{name:t}=r,u=ee("Chunk",p.current),y=C?.includes(t),X=h?.includes(t);if(y)if(t==="Atmosphere")r.visible=!0,R.set(1);else if(t==="Chunk"){let E=new Q(-.4,.4,.4);r.visible=!0,$?r.position.set(...E.toArray()):(I.set(E.x),j.set(E.y),W.set(E.z))}else t==="EarthFull"&&u.visible?r.visible=!1:r.visible=!0;else if(X&&!y)if(t==="Atmosphere")R.set(0);else if(t==="Chunk"){let E=new Q(0,0,0);St(E,u.position)&&(r.visible=!1),I.set(E.x),j.set(E.y),W.set(E.z)}else t==="EarthPartial"&&u.visible?r.visible=!0:r.visible=!1})},l=m=>{let C=g.current[m].animations;$||(U.current.forEach((r,t)=>{C.find(u=>u.includes(t.toString()))||V.current.clipAction(r).reset().stop()}),U.current.length&&g.current[m].animations&&C.forEach(r=>{let t=r.split(":"),u=U.current[Number(t[0])],y=V.current.clipAction(u);(!t[1]||t[1]!=="loop")&&(y.clampWhenFinished=!0,y.loop=Ue),y.play()}))},s=m=>{K.current.forEach(r=>{r.hidden&&(r.element.dataset.hidden=!0,r.element.setAttribute("aria-hidden",!0))}),g.current[m].labels.forEach(r=>{K.current.filter(u=>u.text===r).forEach(u=>{u.element.dataset.hidden=!1,u.element.setAttribute("aria-hidden",!1)})})};requestAnimationFrame(()=>{let m=g.current.length-1,C=Math.floor(a/o),r=he(C,0,m),t=g.current[r],u=g.current[r+1],y=be(t)||ye,X=be(u)||ye,E=(a-o*r)/o,le=he(E,0,1),Le=ge(y.x,X.x,le),ke=ge(y.y,X.y,le),Ae=ge(y.z,X.z,le);if(b!==y&&g.current.length&&t&&(w(r),l(r),s(r)),b=y,!F){if($){i.current.position.set(Le,ke,Ae);return}k.set(Le),A.set(ke),M.set(Ae)}})},[k,A,M,I,j,W,F,h,R,$]);(0,e.useEffect)(()=>{let n=ft(Ee,100);return d&&O&&window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)}},[Ee,O,d,R]);let vt=(0,e.useCallback)(n=>{g.current=[...g.current,n]},[]),wt=(0,e.useCallback)(n=>{g.current=g.current.filter(o=>o!==n)},[]);return(0,v.jsx)(gt.Provider,{value:{registerSection:vt,unregisterSection:wt},children:(0,v.jsxs)("div",{className:pe(L.earth,Z),ref:ne,children:[(0,v.jsxs)("div",{className:L.viewport,children:[(0,v.jsx)("canvas",{className:L.canvas,"data-visible":d&&q,"data-grabbing":F,ref:H}),(0,v.jsx)("div",{className:L.labels,"aria-live":"polite",ref:re}),(0,v.jsx)("div",{className:L.vignette})]}),(0,v.jsx)("div",{className:L.sections,children:B}),(0,v.jsx)(Oe,{unmount:!0,in:!d&&J,timeout:Pe(Ne.base.durationL),children:n=>(0,v.jsx)(He,{className:L.loader,"data-visible":n,children:(0,v.jsx)(Fe,{})})})]})})},Jt=(0,e.memo)(({children:c,scrim:f,scrimReverse:h,className:z,camera:Z=[0,0,0],animations:B=[],meshes:d=[],labels:G=[]})=>{let{registerSection:F,unregisterSection:D}=(0,e.useContext)(gt),q=(0,e.useRef)(),te=JSON.stringify(B)+JSON.stringify(Z)+JSON.stringify(G)+JSON.stringify(d);return(0,e.useEffect)(()=>{let J={camera:Z,animations:B,meshes:d,labels:G,sectionRef:q};return F(J),()=>{D(J)}},[te,F,D]),(0,v.jsx)("div",{className:pe(L.section,z),"data-scrim":f,"data-scrim-reverse":h,ref:q,children:c})});export{qt as Earth,Jt as EarthSection};
